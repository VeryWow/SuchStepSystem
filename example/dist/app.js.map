{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","classes/Step.js","classes/StepSystem.js","example/app.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;ICAa,I,WAAA,I;AACX,gBAAa,MAAb,EAAqB;AAAA;;AACnB,SAAK,MAAL,GAAc,OAAO,MAAP,IAAiB,IAA/B;AACA,SAAK,IAAL,GAAY,OAAO,IAAnB;AACA,SAAK,IAAL,GAAY,OAAO,IAAnB;AACA,SAAK,OAAL,GAAe,OAAO,OAAP,IAAkB,EAAjC;AACA,SAAK,QAAL,GAAgB,OAAO,QAAP,IAAmB,EAAnC;AACA,SAAK,eAAL,GAAuB,OAAO,eAAP,IAA0B,KAAjD;AACA,SAAK,IAAL,GAAY,IAAZ;AACA,SAAK,KAAL,GAAa,OAAO,IAAP,IAAe,EAA5B;AACA,WAAO,YAAP,GAAsB,OAAO,YAAP,IAAuB,EAA7C;AACA,SAAK,YAAL,GAAoB;AAClB,oBAAc,OAAO,YAAP,CAAoB,YAApB,IAAoC,KAAK,OAAL,CAAa,YAAjD,IAAiE,YAAY;AACzF,eAAO,EAAC,QAAQ,IAAT,EAAP;AACD,OAHiB;AAIlB,kBAAY,OAAO,YAAP,CAAoB,UAApB,IAAkC,KAAK,OAAL,CAAa,UAA/C,IAA6D,YAAY;AACnF,eAAO,EAAC,QAAQ,IAAT,EAAP;AACD,OANiB;AAOlB,kBAAY,OAAO,YAAP,CAAoB,UAApB,IAAkC,KAAK,OAAL,CAAa,UAA/C,IAA6D,YAAY;AACnF,eAAO,EAAC,QAAQ,IAAT,EAAP;AACD;AATiB,KAApB;AAWD;;AAED;;;;;wBACc;AAAE,aAAO,KAAK,MAAL,CAAY,MAAnB;AAA2B;;;wBAC7B;AAAE,aAAO,KAAK,MAAL,CAAY,MAAnB;AAA2B;;;wBAC3B;AAAE,aAAO,KAAK,MAAL,CAAY,QAAnB;AAA6B;;;wBAEnC;AACV,aAAO,KAAK,KAAZ;AACD;;;;;;;;;;;;;;;;;AC/BH;;;;;;;;;IASa,U,WAAA,U;AACX;;;AAGA,sBAAa,MAAb,EAAqB;AAAA;;AACnB,SAAK,MAAL,GAAc,EAAd;AACA,SAAK,aAAL,GAAqB,IAArB;AACA,SAAK,UAAL,GAAkB,OAAO,SAAP,IAAoB,EAAE,cAAF,CAAtC;AACA,SAAK,eAAL,GAAuB,OAAO,UAAP,IAAqB,OAA5C;AACA,SAAK,aAAL,GAAqB,IAArB;AACA,SAAK,UAAL,GAAkB,EAAlB;AACA,SAAK,QAAL,GAAgB,CAAhB;AACA,SAAK,cAAL,GAAsB,YAAY,CAAE,CAApC;AACA,SAAK,QAAL,GAAgB,YAAY,CAAE,CAA9B;AACA,SAAK,UAAL,GAAkB,YAAY,CAAE,CAAhC;AACA,SAAK,YAAL,GAAoB,YAAY,CAAE,CAAlC;AACD;;AAED;;;;;;;;4BAIS,I,EAAM;AACb,WAAK,MAAL,GAAc,IAAd;AACA,WAAK,MAAL,CAAY,KAAK,IAAjB,IAAyB,IAAzB;AACA,aAAO,IAAP;AACD;;;gCAEY,E,EAAI;AACf,WAAK,cAAL,GAAsB,EAAtB;AACA,aAAO,IAAP;AACD;;;yBAMK,I,EAAM;AACV,aAAO,KAAK,MAAL,CAAY,IAAZ,CAAP;AACD;;;2BAUO,I,EAAM;AACZ,UAAI,MAAM,KAAK,YAAL,CAAkB,YAAlB,EAAV;AACA,UAAI,CAAC,IAAI,MAAT,EAAiB;AACf,YAAI,IAAI,OAAR,EAAiB,IAAI,OAAJ;AACjB,eAAO,IAAP;AACD;AACD,WAAK,SAAL,CAAe,IAAf,CAAoB,KAAK,eAAzB,EAA0C,IAA1C,CAA+C,KAAK,QAAL,IAAiB,KAAK,UAAL,CAAgB,IAAhB,OAAyB,KAAK,IAA9B,EAAsC,IAAtC,EAAhE;AACA,WAAK,SAAL,CAAe,IAAf,CAAoB,KAAK,eAAzB,EAA0C,IAA1C,CAA+C,WAA/C,EAA4D,KAAK,IAAjE;AACA,WAAK,YAAL,CAAkB,IAAlB;AACA,UAAI,KAAK,OAAL,CAAa,QAAjB,EAA2B;AACzB,aAAK,OAAL,CAAa,QAAb;AACD;AACF;;;qCAEiB;AAChB,UAAI,eAAe,CAAnB;AACA,UAAI,iBAAiB,KAAK,YAA1B;AACA,UAAI,sBAAsB,eAAe,IAAzC;AACA,aAAO,mBAAP,EAA4B;AAC1B,YAAI,CAAC,eAAe,eAApB,EAAqC;AACnC;AACD;AACD,yBAAiB,KAAK,IAAL,CAAU,mBAAV,CAAjB;AACA,8BAAsB,eAAe,IAArC;AACD;AACD,WAAK,QAAL,GAAiB,KAAK,UAAL,CAAgB,MAAhB,GAAyB,GAA1B,IAAkC,KAAK,UAAL,CAAgB,MAAhB,GAAyB,YAA3D,CAAhB;AACA,WAAK,UAAL,CAAgB,KAAK,QAArB;AACD;;;oCAE6B;AAAA,UAAf,OAAe,uEAAL,GAAK;;AAC5B,UAAM,QAAQ,IAAd;AACA,mBAAa,KAAK,aAAlB;AACA,WAAK,aAAL,GAAqB,WAAW,YAAY;AAC1C,cAAM,MAAN;AACD,OAFoB,EAElB,OAFkB,CAArB;AAGD;;;6BAES;AACR,UAAI,YAAY,KAAK,YAAL,IAAqB,EAArC;AACA,UAAI,YAAY,UAAU,IAAV,IAAkB,IAAlC;AACA,UAAI,MAAM,UAAU,YAAV,CAAuB,UAAvB,EAAV;AACA,UAAI,CAAC,IAAI,MAAT,EAAiB;AACf,YAAI,IAAI,OAAR,EAAiB,IAAI,OAAJ;AACjB,eAAO,IAAP;AACD;AACD,UAAI,SAAJ,EAAe;AACb,aAAK,QAAL,CAAc,KAAK,IAAL,CAAU,SAAV,CAAd,EAAoC,EAAE,MAAM,UAAU,IAAlB,EAApC;AACD,OAFD,MAEO;AACL,YAAI,KAAK,QAAT,EAAmB;AACjB,eAAK,QAAL;AACD;AACF;AACF;;;6BAES;AACR,UAAI,YAAY,KAAK,YAAL,IAAqB,EAArC;AACA,UAAI,YAAY,UAAU,IAAV,IAAkB,IAAlC;AACA,UAAI,MAAM,UAAU,YAAV,CAAuB,UAAvB,EAAV;AACA,UAAI,CAAC,IAAI,MAAT,EAAiB;AACf,YAAI,IAAI,OAAR,EAAiB,IAAI,OAAJ;AACjB,eAAO,IAAP;AACD;AACD,UAAI,SAAJ,EAAe;AACb,aAAK,UAAL,CAAgB,GAAhB;AACA,aAAK,QAAL,CAAc,KAAK,IAAL,CAAU,SAAV,CAAd,EAAoC,EAAE,SAAS,IAAX,EAApC;AACD;AACF;;;6BAES,I,EAAmB;AAAA,UAAb,MAAa,uEAAJ,EAAI;;AAC3B,UAAI,OAAO,OAAO,IAAP,IAAe,IAA1B;AACA,UAAI,UAAU,OAAO,OAAP,IAAkB,KAAhC;AACA,UAAI,IAAJ,EAAU;AACR,aAAK,IAAL,GAAY,IAAZ;AACD;AACD,WAAK,aAAL,GAAqB,KAAK,IAA1B;AACA,WAAK,MAAL,CAAY,IAAZ;AACA,UAAI,KAAK,UAAL,CAAgB,OAAhB,CAAwB,KAAK,IAA7B,IAAqC,CAArC,IAA0C,CAAC,OAA/C,EAAwD;AACtD,aAAK,UAAL,CAAgB,IAAhB,CAAqB,KAAK,IAA1B;AACD;AACD,WAAK,cAAL;AACD;;;kCAEc;AACb,UAAI,OAAO,EAAX;AACA,WAAK,IAAI,IAAT,IAAiB,KAAK,UAAtB,EAAkC;AAChC,aAAK,KAAK,UAAL,CAAgB,IAAhB,CAAL,IAA8B,KAAK,IAAL,CAAU,KAAK,UAAL,CAAgB,IAAhB,CAAV,EAAiC,IAA/D;AACD;AACD,aAAO,IAAP;AACD;;;yBAEK,S,EAAW;AACf,WAAK,cAAL;AACA,WAAK,aAAL,GAAqB,SAArB;AACA,WAAK,QAAL,CAAc,KAAK,IAAL,CAAU,KAAK,aAAf,CAAd;AACD;;;wBA9GmB;AAClB,aAAO,KAAK,IAAL,CAAU,KAAK,aAAf,KAAiC,IAAxC;AACD;;;wBAMgB;AACf,aAAO,KAAK,UAAZ;AACD;;;wBAEY;AACX,aAAO,KAAK,MAAZ;AACD;;;;;;;;;ACxDH;;AACA;;AAEA,OAAO,GAAP,GAAa,2BAAe,EAAE,YAAF,CAAf,CAAb;;AAEA,CAAC,UAAU,GAAV,EAAe;AAAA;;AAEd,MAAM,aAAa,YAAnB;;AAEA;AACA;;;AADA,GAIC,WAJD,CAIa,YAAM;AACjB,YAAQ,GAAR,CAAY,eAAZ;AACD,GAND;;AAQA;;;AARA,GAWC,OAXD,CAWS,eAAS;AAChB,UAAM,YADU;AAEhB,UAAM,aAFU;AAGhB,aAAS;AACP,oBAAc,wBAAM;AAClB,gBAAQ,GAAR,CAAY,yBAAZ;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OAJM;AAKP,kBAAY,sBAAM;AAChB,gBAAQ,GAAR,CAAY,uBAAZ;AACA,YAAI,YAAJ,CAAiB,IAAjB,CAAsB,GAAtB,GAA4B,KAA5B;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OATM;AAUP,gBAAU,oBAAM;AACd,YAAI,SAAJ,CAAc,IAAd,CAAmB,OAAnB,EAA4B,GAA5B,CAAgC,EAAC,SAAS,OAAV,EAAhC;AACD;AAZM;AAHO,GAAT,CAXT;;AA8BA;;;AA9BA,GAiCC,OAjCD,CAiCS,eAAS;AAChB,UAAM,aADU;AAEhB,UAAM,YAFU;AAGhB,aAAS;AACP,oBAAc,wBAAM;AAClB,gBAAQ,GAAR,CAAY,0BAAZ;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OAJM;AAKP,kBAAY,sBAAM;AAChB,gBAAQ,GAAR,CAAY,wBAAZ;AACA,YAAI,YAAJ,CAAiB,IAAjB,CAAsB,KAAtB,GAA8B,OAA9B;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OATM;AAUP,gBAAU,oBAAM;AACd,YAAI,SAAJ,CAAc,IAAd,CAAmB,OAAnB,EAA4B,GAA5B,CAAgC,EAAC,SAAS,KAAV,EAAhC;AACD;AAZM;AAHO,GAAT,CAjCT;;AAoDA;;;AApDA,GAuDC,OAvDD,CAuDS,eAAS;AAChB,UAAM,YADU;AAEhB,aAAS;AACP,oBAAc,wBAAM;AAClB,gBAAQ,GAAR,CAAY,yBAAZ;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OAJM;AAKP,kBAAY,sBAAM;AAChB,gBAAQ,GAAR,CAAY,uBAAZ;AACA,YAAI,YAAJ,CAAiB,IAAjB,CAAsB,GAAtB,GAA4B,KAA5B;AACA,eAAO,EAAE,QAAQ,IAAV,EAAP;AACD,OATM;AAUP,gBAAU,oBAAM;AACd,YAAI,SAAJ,CAAc,IAAd,CAAmB,OAAnB,EAA4B,GAA5B,CAAgC,EAAC,SAAS,MAAV,EAAhC;AACD;AAZM;AAFO,GAAT,CAvDT;;AAyEA,MAAI,QAAJ,GAAe,YAAM;AACnB,YAAQ,GAAR,CAAY,IAAI,WAAJ,EAAZ;AACD,GAFD;;AAIA,MAAI,UAAJ,GAAiB,UAAC,QAAD,EAAc;AAC7B,QAAI,SAAJ,CAAc,IAAd,CAAmB,WAAnB,EAAgC,IAAhC,CAAqC,KAAK,KAAL,CAAW,QAAX,IAAuB,GAA5D;AACD,GAFD;;AAIA,MAAI,IAAJ,CAAS,UAAT;AAED,CAvFD,EAuFG,OAAO,GAvFV","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","export class Step {\n  constructor (params) {\n    this.parent = params.parent || null\n    this.name = params.name\n    this.next = params.next\n    this.methods = params.methods || {}\n    this.template = params.template || ''\n    this.ignore_progress = params.ignore_progress || false\n    this.from = null\n    this._data = params.data || {}\n    params.interceptors = params.interceptors || {}\n    this.interceptors = {\n      beforeRender: params.interceptors.beforeRender || this.methods.beforeRender || function () {\n        return {status: true}\n      },\n      beforeNext: params.interceptors.beforeNext || this.methods.beforeNext || function () {\n        return {status: true}\n      },\n      beforeBack: params.interceptors.beforeBack || this.methods.beforeBack || function () {\n        return {status: true}\n      }\n    }\n  }\n\n  /* LINKS */\n  get goNext () { return this.parent.goNext }\n  get goBack () { return this.parent.goBack }\n  get goToStep () { return this.parent.goToStep }\n\n  get data () {\n    return this._data\n  }\n}\n","/**\n * StepSystem v1.0.0\n * Last update: 17.05.2017\n *\n * Dependencies: jQuery\n *\n * @author kaskar2008\n */\n\nexport class StepSystem {\n  /**\n   * @param  {jQuery element} container\n   */\n  constructor (params) {\n    this._steps = {}\n    this._current_step = null\n    this._container = params.container || $('.step-system')\n    this._step_container = params.step_class || '.step'\n    this._next_timeout = null\n    this.steps_past = []\n    this.progress = 0\n    this.commonHandlers = function () {}\n    this.onFinish = function () {}\n    this.onProgress = function () {}\n    this.onStepRender = function () {}\n  }\n\n  /**\n   * Add new step\n   * @param {Step} step\n   */\n  addStep (step) {\n    step.parent = this\n    this._steps[step.name] = step\n    return this\n  }\n\n  setHandlers (cb) {\n    this.commonHandlers = cb\n    return this\n  }\n\n  get current_step () {\n    return this.step(this._current_step) || null\n  }\n\n  step (name) {\n    return this._steps[name]\n  }\n\n  get container () {\n    return this._container\n  }\n\n  get steps () {\n    return this._steps\n  }\n\n  render (step) {\n    let _br = step.interceptors.beforeRender()\n    if (!_br.status) {\n      if (_br.onError) _br.onError()\n      return this\n    }\n    this.container.find(this._step_container).html(step.template || this._container.find(`#${step.name}`).html())\n    this.container.find(this._step_container).attr('data-name', step.name)\n    this.onStepRender(step)\n    if (step.methods.onRender) {\n      step.methods.onRender()\n    }\n  }\n\n  updateProgress () {\n    let future_steps = 0\n    let iteration_step = this.current_step\n    let iteration_next_step = iteration_step.next\n    while (iteration_next_step) {\n      if (!iteration_step.ignore_progress) {\n        future_steps++\n      }\n      iteration_step = this.step(iteration_next_step)\n      iteration_next_step = iteration_step.next\n    }\n    this.progress = (this.steps_past.length * 100) / (this.steps_past.length + future_steps)\n    this.onProgress(this.progress)\n  }\n\n  goNextTimeout (timeout = 300) {\n    const $this = this\n    clearTimeout(this._next_timeout)\n    this._next_timeout = setTimeout(function () {\n      $this.goNext()\n    }, timeout)\n  }\n\n  goNext () {\n    let curr_step = this.current_step || {}\n    let next_step = curr_step.next || null\n    let _bn = curr_step.interceptors.beforeNext()\n    if (!_bn.status) {\n      if (_bn.onError) _bn.onError()\n      return this\n    }\n    if (next_step) {\n      this.goToStep(this.step(next_step), { from: curr_step.name })\n    } else {\n      if (this.onFinish) {\n        this.onFinish()\n      }\n    }\n  }\n\n  goBack () {\n    let curr_step = this.current_step || {}\n    let prev_step = curr_step.from || null\n    let _bb = curr_step.interceptors.beforeBack()\n    if (!_bb.status) {\n      if (_bb.onError) _bb.onError()\n      return this\n    }\n    if (prev_step) {\n      this.steps_past.pop()\n      this.goToStep(this.step(prev_step), { is_back: true })\n    }\n  }\n\n  goToStep (step, params = {}) {\n    let from = params.from || null\n    let is_back = params.is_back || false\n    if (from) {\n      step.from = from\n    }\n    this._current_step = step.name\n    this.render(step)\n    if (this.steps_past.indexOf(step.name) < 0 && !is_back) {\n      this.steps_past.push(step.name)\n    }\n    this.updateProgress()\n  }\n\n  collectData () {\n    let data = {}\n    for (var step in this.steps_past) {\n      data[this.steps_past[step]] = this.step(this.steps_past[step]).data\n    }\n    return data\n  }\n\n  init (from_step) {\n    this.commonHandlers()\n    this._current_step = from_step\n    this.goToStep(this.step(this._current_step))\n  }\n}\n","import { Step } from '../classes/Step'\nimport { StepSystem } from '../classes/StepSystem'\n\nwindow.app = new StepSystem($('.container'));\n\n(function (app) {\n\n  const first_step = 'first-step'\n\n  app\n  /**\n   * COMMON HANDLERS\n   */\n  .setHandlers(() => {\n    console.log('handlers init')\n  })\n  \n  /**\n   * FIRST STEP\n   */\n  .addStep(new Step({\n    name: 'first-step',\n    next: 'second-step',\n    methods: {\n      beforeRender: () => {\n        console.log('first-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: () => {\n        console.log('first-step beforeNext', this)\n        app.current_step.data.lol = 'lol'\n        return { status: true }\n      },\n      onRender: () => {\n        app.container.find('.step').css({'color': 'green'})\n      }\n    }\n  }))\n\n  /**\n   * SECOND STEP\n   */\n  .addStep(new Step({\n    name: 'second-step',\n    next: 'third-step',\n    methods: {\n      beforeRender: () => {\n        console.log('second-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: () => {\n        console.log('second-step beforeNext')\n        app.current_step.data.azaza = 'azaza'\n        return { status: true }\n      },\n      onRender: () => {\n        app.container.find('.step').css({'color': 'red'})\n      }\n    }\n  }))\n\n  /**\n   * THIRD STEP\n   */\n  .addStep(new Step({\n    name: 'third-step',\n    methods: {\n      beforeRender: () => {\n        console.log('third-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: () => {\n        console.log('third-step beforeNext')\n        app.current_step.data.kek = 'kek'\n        return { status: true }\n      },\n      onRender: () => {\n        app.container.find('.step').css({'color': 'blue'})\n      }\n    }\n  }))\n\n  app.onFinish = () => {\n    console.log(app.collectData())\n  }\n\n  app.onProgress = (progress) => {\n    app.container.find('.progress').html(Math.floor(progress) + '%')\n  }\n\n  app.init(first_step)\n\n})(window.app)\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjbGFzc2VzL1N0ZXAuanMiLCJjbGFzc2VzL1N0ZXBTeXN0ZW0uanMiLCJleGFtcGxlL2FwcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7SUNBYSxJLFdBQUEsSTtBQUNYLGdCQUFhLE1BQWIsRUFBcUI7QUFBQTs7QUFDbkIsU0FBSyxNQUFMLEdBQWMsT0FBTyxNQUFQLElBQWlCLElBQS9CO0FBQ0EsU0FBSyxJQUFMLEdBQVksT0FBTyxJQUFuQjtBQUNBLFNBQUssSUFBTCxHQUFZLE9BQU8sSUFBbkI7QUFDQSxTQUFLLE9BQUwsR0FBZSxPQUFPLE9BQVAsSUFBa0IsRUFBakM7QUFDQSxTQUFLLFFBQUwsR0FBZ0IsT0FBTyxRQUFQLElBQW1CLEVBQW5DO0FBQ0EsU0FBSyxlQUFMLEdBQXVCLE9BQU8sZUFBUCxJQUEwQixLQUFqRDtBQUNBLFNBQUssSUFBTCxHQUFZLElBQVo7QUFDQSxTQUFLLEtBQUwsR0FBYSxPQUFPLElBQVAsSUFBZSxFQUE1QjtBQUNBLFdBQU8sWUFBUCxHQUFzQixPQUFPLFlBQVAsSUFBdUIsRUFBN0M7QUFDQSxTQUFLLFlBQUwsR0FBb0I7QUFDbEIsb0JBQWMsT0FBTyxZQUFQLENBQW9CLFlBQXBCLElBQW9DLEtBQUssT0FBTCxDQUFhLFlBQWpELElBQWlFLFlBQVk7QUFDekYsZUFBTyxFQUFDLFFBQVEsSUFBVCxFQUFQO0FBQ0QsT0FIaUI7QUFJbEIsa0JBQVksT0FBTyxZQUFQLENBQW9CLFVBQXBCLElBQWtDLEtBQUssT0FBTCxDQUFhLFVBQS9DLElBQTZELFlBQVk7QUFDbkYsZUFBTyxFQUFDLFFBQVEsSUFBVCxFQUFQO0FBQ0QsT0FOaUI7QUFPbEIsa0JBQVksT0FBTyxZQUFQLENBQW9CLFVBQXBCLElBQWtDLEtBQUssT0FBTCxDQUFhLFVBQS9DLElBQTZELFlBQVk7QUFDbkYsZUFB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QUFDaEIsVUFBTSxZQURVO0FBRWhCLGFBQVM7QUFDUCxvQkFBYyx3QkFBTTtBQUNsQixnQkFBUSxHQUFSLENBQVkseUJBQVo7QUFDQSxlQUFPLEVBQUUsUUFBUSxJQUFWLEVBQVA7QUFDRCxPQUpNO0FBS1Asa0JBQVksc0JBQU07QUFDaEIsZ0JBQVEsR0FBUixDQUFZLHVCQUFaO0FBQ0EsWUFBSSxZQUFKLENBQWlCLElBQWpCLENBQXNCLEdBQXRCLEdBQTRCLEtBQTVCO0FBQ0EsZUFBTyxFQUFFLFFBQVEsSUFBVixFQUFQO0FBQ0QsT0FUTTtBQVVQLGdCQUFVLG9CQUFNO0FBQ2QsWUFBSSxTQUFKLENBQWMsSUFBZCxDQUFtQixPQUFuQixFQUE0QixHQUE1QixDQUFnQyxFQUFDLFNBQVMsTUFBVixFQUFoQztBQUNEO0FBWk07QUFGTyxHQUFULENBdkRUOztBQXlFQSxNQUFJLFFBQUosR0FBZSxZQUFNO0FBQ25CLFlBQVEsR0FBUixDQUFZLElBQUksV0FBSixFQUFaO0FBQ0QsR0FGRDs7QUFJQSxNQUFJLFVBQUosR0FBaUIsVUFBQyxRQUFELEVBQWM7QUFDN0IsUUFBSSxTQUFKLENBQWMsSUFBZCxDQUFtQixXQUFuQixFQUFnQyxJQUFoQyxDQUFxQyxLQUFLLEtBQUwsQ0FBVyxRQUFYLElBQXVCLEdBQTVEO0FBQ0QsR0FGRDs7QUFJQSxNQUFJLElBQUosQ0FBUyxVQUFUO0FBRUQsQ0F2RkQsRUF1RkcsT0FBTyxHQXZGViIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJleHBvcnQgY2xhc3MgU3RlcCB7XG4gIGNvbnN0cnVjdG9yIChwYXJhbXMpIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmFtcy5wYXJlbnQgfHwgbnVsbFxuICAgIHRoaXMubmFtZSA9IHBhcmFtcy5uYW1lXG4gICAgdGhpcy5uZXh0ID0gcGFyYW1zLm5leHRcbiAgICB0aGlzLm1ldGhvZHMgPSBwYXJhbXMubWV0aG9kcyB8fCB7fVxuICAgIHRoaXMudGVtcGxhdGUgPSBwYXJhbXMudGVtcGxhdGUgfHwgJydcbiAgICB0aGlzLmlnbm9yZV9wcm9ncmVzcyA9IHBhcmFtcy5pZ25vcmVfcHJvZ3Jlc3MgfHwgZmFsc2VcbiAgICB0aGlzLmZyb20gPSBudWxsXG4gICAgdGhpcy5fZGF0YSA9IHBhcmFtcy5kYXRhIHx8IHt9XG4gICAgcGFyYW1zLmludGVyY2VwdG9ycyA9IHBhcmFtcy5pbnRlcmNlcHRvcnMgfHwge31cbiAgICB0aGlzLmludGVyY2VwdG9ycyA9IHtcbiAgICAgIGJlZm9yZVJlbmRlcjogcGFyYW1zLmludGVyY2VwdG9ycy5iZWZvcmVSZW5kZXIgfHwgdGhpcy5tZXRob2RzLmJlZm9yZVJlbmRlciB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7c3RhdHVzOiB0cnVlfVxuICAgICAgfSxcbiAgICAgIGJlZm9yZU5leHQ6IHBhcmFtcy5pbnRlcmNlcHRvcnMuYmVmb3JlTmV4dCB8fCB0aGlzLm1ldGhvZHMuYmVmb3JlTmV4dCB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7c3RhdHVzOiB0cnVlfVxuICAgICAgfSxcbiAgICAgIGJlZm9yZUJhY2s6IHBhcmFtcy5pbnRlcmNlcHRvcnMuYmVmb3JlQmFjayB8fCB0aGlzLm1ldGhvZHMuYmVmb3JlQmFjayB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7c3RhdHVzOiB0cnVlfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qIExJTktTICovXG4gIGdldCBnb05leHQgKCkgeyByZXR1cm4gdGhpcy5wYXJlbnQuZ29OZXh0IH1cbiAgZ2V0IGdvQmFjayAoKSB7IHJldHVybiB0aGlzLnBhcmVudC5nb0JhY2sgfVxuICBnZXQgZ29Ub1N0ZXAgKCkgeyByZXR1cm4gdGhpcy5wYXJlbnQuZ29Ub1N0ZXAgfVxuXG4gIGdldCBkYXRhICgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YVxuICB9XG59XG4iLCIvKipcbiAqIFN0ZXBTeXN0ZW0gdjEuMC4wXG4gKiBMYXN0IHVwZGF0ZTogMTcuMDUuMjAxN1xuICpcbiAqIERlcGVuZGVuY2llczogalF1ZXJ5XG4gKlxuICogQGF1dGhvciBrYXNrYXIyMDA4XG4gKi9cblxuZXhwb3J0IGNsYXNzIFN0ZXBTeXN0ZW0ge1xuICAvKipcbiAgICogQHBhcmFtICB7alF1ZXJ5IGVsZW1lbnR9IGNvbnRhaW5lclxuICAgKi9cbiAgY29uc3RydWN0b3IgKHBhcmFtcykge1xuICAgIHRoaXMuX3N0ZXBzID0ge31cbiAgICB0aGlzLl9jdXJyZW50X3N0ZXAgPSBudWxsXG4gICAgdGhpcy5fY29udGFpbmVyID0gcGFyYW1zLmNvbnRhaW5lciB8fCAkKCcuc3RlcC1zeXN0ZW0nKVxuICAgIHRoaXMuX3N0ZXBfY29udGFpbmVyID0gcGFyYW1zLnN0ZXBfY2xhc3MgfHwgJy5zdGVwJ1xuICAgIHRoaXMuX25leHRfdGltZW91dCA9IG51bGxcbiAgICB0aGlzLnN0ZXBzX3Bhc3QgPSBbXVxuICAgIHRoaXMucHJvZ3Jlc3MgPSAwXG4gICAgdGhpcy5jb21tb25IYW5kbGVycyA9IGZ1bmN0aW9uICgpIHt9XG4gICAgdGhpcy5vbkZpbmlzaCA9IGZ1bmN0aW9uICgpIHt9XG4gICAgdGhpcy5vblByb2dyZXNzID0gZnVuY3Rpb24gKCkge31cbiAgICB0aGlzLm9uU3RlcFJlbmRlciA9IGZ1bmN0aW9uICgpIHt9XG4gIH1cblxuICAvKipcbiAgICogQWRkIG5ldyBzdGVwXG4gICAqIEBwYXJhbSB7U3RlcH0gc3RlcFxuICAgKi9cbiAgYWRkU3RlcCAoc3RlcCkge1xuICAgIHN0ZXAucGFyZW50ID0gdGhpc1xuICAgIHRoaXMuX3N0ZXBzW3N0ZXAubmFtZV0gPSBzdGVwXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHNldEhhbmRsZXJzIChjYikge1xuICAgIHRoaXMuY29tbW9uSGFuZGxlcnMgPSBjYlxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBnZXQgY3VycmVudF9zdGVwICgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGVwKHRoaXMuX2N1cnJlbnRfc3RlcCkgfHwgbnVsbFxuICB9XG5cbiAgc3RlcCAobmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9zdGVwc1tuYW1lXVxuICB9XG5cbiAgZ2V0IGNvbnRhaW5lciAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lclxuICB9XG5cbiAgZ2V0IHN0ZXBzICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RlcHNcbiAgfVxuXG4gIHJlbmRlciAoc3RlcCkge1xuICAgIGxldCBfYnIgPSBzdGVwLmludGVyY2VwdG9ycy5iZWZvcmVSZW5kZXIoKVxuICAgIGlmICghX2JyLnN0YXR1cykge1xuICAgICAgaWYgKF9ici5vbkVycm9yKSBfYnIub25FcnJvcigpXG4gICAgICByZXR1cm4gdGhpc1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lci5maW5kKHRoaXMuX3N0ZXBfY29udGFpbmVyKS5odG1sKHN0ZXAudGVtcGxhdGUgfHwgdGhpcy5fY29udGFpbmVyLmZpbmQoYCMke3N0ZXAubmFtZX1gKS5odG1sKCkpXG4gICAgdGhpcy5jb250YWluZXIuZmluZCh0aGlzLl9zdGVwX2NvbnRhaW5lcikuYXR0cignZGF0YS1uYW1lJywgc3RlcC5uYW1lKVxuICAgIHRoaXMub25TdGVwUmVuZGVyKHN0ZXApXG4gICAgaWYgKHN0ZXAubWV0aG9kcy5vblJlbmRlcikge1xuICAgICAgc3RlcC5tZXRob2RzLm9uUmVuZGVyKClcbiAgICB9XG4gIH1cblxuICB1cGRhdGVQcm9ncmVzcyAoKSB7XG4gICAgbGV0IGZ1dHVyZV9zdGVwcyA9IDBcbiAgICBsZXQgaXRlcmF0aW9uX3N0ZXAgPSB0aGlzLmN1cnJlbnRfc3RlcFxuICAgIGxldCBpdGVyYXRpb25fbmV4dF9zdGVwID0gaXRlcmF0aW9uX3N0ZXAubmV4dFxuICAgIHdoaWxlIChpdGVyYXRpb25fbmV4dF9zdGVwKSB7XG4gICAgICBpZiAoIWl0ZXJhdGlvbl9zdGVwLmlnbm9yZV9wcm9ncmVzcykge1xuICAgICAgICBmdXR1cmVfc3RlcHMrK1xuICAgICAgfVxuICAgICAgaXRlcmF0aW9uX3N0ZXAgPSB0aGlzLnN0ZXAoaXRlcmF0aW9uX25leHRfc3RlcClcbiAgICAgIGl0ZXJhdGlvbl9uZXh0X3N0ZXAgPSBpdGVyYXRpb25fc3RlcC5uZXh0XG4gICAgfVxuICAgIHRoaXMucHJvZ3Jlc3MgPSAodGhpcy5zdGVwc19wYXN0Lmxlbmd0aCAqIDEwMCkgLyAodGhpcy5zdGVwc19wYXN0Lmxlbmd0aCArIGZ1dHVyZV9zdGVwcylcbiAgICB0aGlzLm9uUHJvZ3Jlc3ModGhpcy5wcm9ncmVzcylcbiAgfVxuXG4gIGdvTmV4dFRpbWVvdXQgKHRpbWVvdXQgPSAzMDApIHtcbiAgICBjb25zdCAkdGhpcyA9IHRoaXNcbiAgICBjbGVhclRpbWVvdXQodGhpcy5fbmV4dF90aW1lb3V0KVxuICAgIHRoaXMuX25leHRfdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgJHRoaXMuZ29OZXh0KClcbiAgICB9LCB0aW1lb3V0KVxuICB9XG5cbiAgZ29OZXh0ICgpIHtcbiAgICBsZXQgY3Vycl9zdGVwID0gdGhpcy5jdXJyZW50X3N0ZXAgfHwge31cbiAgICBsZXQgbmV4dF9zdGVwID0gY3Vycl9zdGVwLm5leHQgfHwgbnVsbFxuICAgIGxldCBfYm4gPSBjdXJyX3N0ZXAuaW50ZXJjZXB0b3JzLmJlZm9yZU5leHQoKVxuICAgIGlmICghX2JuLnN0YXR1cykge1xuICAgICAgaWYgKF9ibi5vbkVycm9yKSBfYm4ub25FcnJvcigpXG4gICAgICByZXR1cm4gdGhpc1xuICAgIH1cbiAgICBpZiAobmV4dF9zdGVwKSB7XG4gICAgICB0aGlzLmdvVG9TdGVwKHRoaXMuc3RlcChuZXh0X3N0ZXApLCB7IGZyb206IGN1cnJfc3RlcC5uYW1lIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLm9uRmluaXNoKSB7XG4gICAgICAgIHRoaXMub25GaW5pc2goKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdvQmFjayAoKSB7XG4gICAgbGV0IGN1cnJfc3RlcCA9IHRoaXMuY3VycmVudF9zdGVwIHx8IHt9XG4gICAgbGV0IHByZXZfc3RlcCA9IGN1cnJfc3RlcC5mcm9tIHx8IG51bGxcbiAgICBsZXQgX2JiID0gY3Vycl9zdGVwLmludGVyY2VwdG9ycy5iZWZvcmVCYWNrKClcbiAgICBpZiAoIV9iYi5zdGF0dXMpIHtcbiAgICAgIGlmIChfYmIub25FcnJvcikgX2JiLm9uRXJyb3IoKVxuICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG4gICAgaWYgKHByZXZfc3RlcCkge1xuICAgICAgdGhpcy5zdGVwc19wYXN0LnBvcCgpXG4gICAgICB0aGlzLmdvVG9TdGVwKHRoaXMuc3RlcChwcmV2X3N0ZXApLCB7IGlzX2JhY2s6IHRydWUgfSlcbiAgICB9XG4gIH1cblxuICBnb1RvU3RlcCAoc3RlcCwgcGFyYW1zID0ge30pIHtcbiAgICBsZXQgZnJvbSA9IHBhcmFtcy5mcm9tIHx8IG51bGxcbiAgICBsZXQgaXNfYmFjayA9IHBhcmFtcy5pc19iYWNrIHx8IGZhbHNlXG4gICAgaWYgKGZyb20pIHtcbiAgICAgIHN0ZXAuZnJvbSA9IGZyb21cbiAgICB9XG4gICAgdGhpcy5fY3VycmVudF9zdGVwID0gc3RlcC5uYW1lXG4gICAgdGhpcy5yZW5kZXIoc3RlcClcbiAgICBpZiAodGhpcy5zdGVwc19wYXN0LmluZGV4T2Yoc3RlcC5uYW1lKSA8IDAgJiYgIWlzX2JhY2spIHtcbiAgICAgIHRoaXMuc3RlcHNfcGFzdC5wdXNoKHN0ZXAubmFtZSlcbiAgICB9XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzcygpXG4gIH1cblxuICBjb2xsZWN0RGF0YSAoKSB7XG4gICAgbGV0IGRhdGEgPSB7fVxuICAgIGZvciAodmFyIHN0ZXAgaW4gdGhpcy5zdGVwc19wYXN0KSB7XG4gICAgICBkYXRhW3RoaXMuc3RlcHNfcGFzdFtzdGVwXV0gPSB0aGlzLnN0ZXAodGhpcy5zdGVwc19wYXN0W3N0ZXBdKS5kYXRhXG4gICAgfVxuICAgIHJldHVybiBkYXRhXG4gIH1cblxuICBpbml0IChmcm9tX3N0ZXApIHtcbiAgICB0aGlzLmNvbW1vbkhhbmRsZXJzKClcbiAgICB0aGlzLl9jdXJyZW50X3N0ZXAgPSBmcm9tX3N0ZXBcbiAgICB0aGlzLmdvVG9TdGVwKHRoaXMuc3RlcCh0aGlzLl9jdXJyZW50X3N0ZXApKVxuICB9XG59XG4iLCJpbXBvcnQgeyBTdGVwIH0gZnJvbSAnLi4vY2xhc3Nlcy9TdGVwJ1xuaW1wb3J0IHsgU3RlcFN5c3RlbSB9IGZyb20gJy4uL2NsYXNzZXMvU3RlcFN5c3RlbSdcblxud2luZG93LmFwcCA9IG5ldyBTdGVwU3lzdGVtKCQoJy5jb250YWluZXInKSk7XG5cbihmdW5jdGlvbiAoYXBwKSB7XG5cbiAgY29uc3QgZmlyc3Rfc3RlcCA9ICdmaXJzdC1zdGVwJ1xuXG4gIGFwcFxuICAvKipcbiAgICogQ09NTU9OIEhBTkRMRVJTXG4gICAqL1xuICAuc2V0SGFuZGxlcnMoKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdoYW5kbGVycyBpbml0JylcbiAgfSlcbiAgXG4gIC8qKlxuICAgKiBGSVJTVCBTVEVQXG4gICAqL1xuICAuYWRkU3RlcChuZXcgU3RlcCh7XG4gICAgbmFtZTogJ2ZpcnN0LXN0ZXAnLFxuICAgIG5leHQ6ICdzZWNvbmQtc3RlcCcsXG4gICAgbWV0aG9kczoge1xuICAgICAgYmVmb3JlUmVuZGVyOiAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmaXJzdC1zdGVwIGJlZm9yZVJlbmRlcicpXG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSB9XG4gICAgICB9LFxuICAgICAgYmVmb3JlTmV4dDogKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnZmlyc3Qtc3RlcCBiZWZvcmVOZXh0JywgdGhpcylcbiAgICAgICAgYXBwLmN1cnJlbnRfc3RlcC5kYXRhLmxvbCA9ICdsb2wnXG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSB9XG4gICAgICB9LFxuICAgICAgb25SZW5kZXI6ICgpID0+IHtcbiAgICAgICAgYXBwLmNvbnRhaW5lci5maW5kKCcuc3RlcCcpLmNzcyh7J2NvbG9yJzogJ2dyZWVuJ30pXG4gICAgICB9XG4gICAgfVxuICB9KSlcblxuICAvKipcbiAgICogU0VDT05EIFNURVBcbiAgICovXG4gIC5hZGRTdGVwKG5ldyBTdGVwKHtcbiAgICBuYW1lOiAnc2Vjb25kLXN0ZXAnLFxuICAgIG5leHQ6ICd0aGlyZC1zdGVwJyxcbiAgICBtZXRob2RzOiB7XG4gICAgICBiZWZvcmVSZW5kZXI6ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3NlY29uZC1zdGVwIGJlZm9yZVJlbmRlcicpXG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSB9XG4gICAgICB9LFxuICAgICAgYmVmb3JlTmV4dDogKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnc2Vjb25kLXN0ZXAgYmVmb3JlTmV4dCcpXG4gICAgICAgIGFwcC5jdXJyZW50X3N0ZXAuZGF0YS5hemF6YSA9ICdhemF6YSdcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlIH1cbiAgICAgIH0sXG4gICAgICBvblJlbmRlcjogKCkgPT4ge1xuICAgICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwJykuY3NzKHsnY29sb3InOiAncmVkJ30pXG4gICAgICB9XG4gICAgfVxuICB9KSlcblxuICAvKipcbiAgICogVEhJUkQgU1RFUFxuICAgKi9cbiAgLmFkZFN0ZXAobmV3IFN0ZXAoe1xuICAgIG5hbWU6ICd0aGlyZC1zdGVwJyxcbiAgICBtZXRob2RzOiB7XG4gICAgICBiZWZvcmVSZW5kZXI6ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXJkLXN0ZXAgYmVmb3JlUmVuZGVyJylcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlIH1cbiAgICAgIH0sXG4gICAgICBiZWZvcmVOZXh0OiAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aGlyZC1zdGVwIGJlZm9yZU5leHQnKVxuICAgICAgICBhcHAuY3VycmVudF9zdGVwLmRhdGEua2VrID0gJ2tlaydcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlIH1cbiAgICAgIH0sXG4gICAgICBvblJlbmRlcjogKCkgPT4ge1xuICAgICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwJykuY3NzKHsnY29sb3InOiAnYmx1ZSd9KVxuICAgICAgfVxuICAgIH1cbiAgfSkpXG5cbiAgYXBwLm9uRmluaXNoID0gKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGFwcC5jb2xsZWN0RGF0YSgpKVxuICB9XG5cbiAgYXBwLm9uUHJvZ3Jlc3MgPSAocHJvZ3Jlc3MpID0+IHtcbiAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5wcm9ncmVzcycpLmh0bWwoTWF0aC5mbG9vcihwcm9ncmVzcykgKyAnJScpXG4gIH1cblxuICBhcHAuaW5pdChmaXJzdF9zdGVwKVxuXG59KSh3aW5kb3cuYXBwKVxuIl19"}
{"version":3,"sources":["node_modules/browser-pack/_prelude.js","classes/Step.js","classes/StepSystem.js","example/app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","export class Step {\n  constructor (params) {\n    this.parent = params.parent || null\n    this.name = params.name\n    this.next = params.next\n    this.methods = params.methods || {}\n    this.template = params.template || ''\n    this.ignore_progress = params.ignore_progress || false\n    this.hide_progress = params.hide_progress || false\n    this.from = null\n    this.required = params.required || false\n    this._data = params.data || {}\n    params.interceptors = params.interceptors || {}\n    this.interceptors = {\n      isSkip: params.interceptors.isSkip || this.methods.isSkip || function () {\n        return false\n      },\n      beforeRender: params.interceptors.beforeRender || this.methods.beforeRender || function () {\n        return {status: true}\n      },\n      beforeNext: params.interceptors.beforeNext || this.methods.beforeNext || function () {\n        return {status: true}\n      },\n      beforeBack: params.interceptors.beforeBack || this.methods.beforeBack || function () {\n        return {status: true}\n      }\n    }\n  }\n\n  /* LINKS */\n  get goNext () { return this.parent.goNext }\n  get goBack () { return this.parent.goBack }\n  get goToStep () { return this.parent.goToStep }\n\n  get data () {\n    return this._data\n  }\n\n  get container () {\n    return this.parent.container.find(this.parent._step_container)\n  }\n\n  call (method, ...args) {\n    let fnc = this.methods[method] || this.interceptors[method]\n    if (fnc) {\n      return fnc.apply(this, args)\n    }\n  }\n}\n","/**\n * StepSystem v1.0.1\n * Last update: 25.05.2017\n *\n * Dependencies: jQuery\n *\n * @author kaskar2008\n */\n\nexport class StepSystem {\n  /**\n   * @param  {jQuery element} container\n   */\n  constructor (params) {\n    this._steps = {}\n    this._current_step = null\n    this._container = params.container || $('.step-system')\n    this._step_container = params.step_class || '.step'\n    this._next_timeout = null\n    this.steps_past = []\n    this.progress = 0\n    this.commonHandlers = function () {}\n    this.onFinish = function () {}\n    this.onProgress = function () {}\n    this.onStepRender = function () {}\n\n    this._global_interceptors = {\n      isSkipGlobal: function (step) {\n        return step.interceptors.isSkip(step)\n      },\n      beforeNext: function (step) {\n        return new Promise((resolve) => {\n          resolve()\n        })\n      },\n      beforeBack: function (step) {\n        return new Promise((resolve) => {\n          resolve()\n        })\n      }\n    }\n  }\n\n  /**\n   * Add new step\n   * @param {Step} step\n   */\n  addStep (step) {\n    step.parent = this\n    this._steps[step.name] = step\n    return this\n  }\n\n  setGlobalInterceptors (interceptors) {\n    this._global_interceptors = Object.assign(this._global_interceptors, interceptors)\n    return this\n  }\n\n  setHandlers (cb) {\n    this.commonHandlers = cb\n    return this\n  }\n\n  get global_interceptors () {\n    return this._global_interceptors\n  }\n\n  get current_step () {\n    return this.step(this._current_step) || null\n  }\n\n  step (name) {\n    return this._steps[name]\n  }\n\n  get container () {\n    return this._container\n  }\n\n  get steps () {\n    return this._steps\n  }\n\n  get all_data () {\n    return this.collectData()\n  }\n\n  render (step) {\n    let _br = step.call('beforeRender', step)\n    if (!_br.status) {\n      if (_br.onError) _br.onError.apply(step)\n      return this\n    }\n    this.container.find(this._step_container).html(step.template || this._container.find(`#${step.name}`).html())\n    this.container.find(this._step_container).attr('data-name', step.name)\n    this.onStepRender(step)\n    step.call('onRender', step)\n  }\n\n  updateProgress () {\n    let future_steps = 0\n    let iteration_step = this.current_step\n    let iteration_next_step = iteration_step.next\n    while (iteration_next_step) {\n      if (!iteration_step.ignore_progress) {\n        future_steps++\n      }\n      iteration_step = this.step(iteration_next_step)\n      iteration_next_step = iteration_step.next\n    }\n    this.progress = (this.steps_past.length * 100) / (this.steps_past.length + future_steps)\n    this.onProgress(this.progress)\n  }\n\n  goNextTimeout (timeout = 300) {\n    const $this = this\n    clearTimeout(this._next_timeout)\n    this._next_timeout = setTimeout(function () {\n      $this.goNext()\n    }, timeout)\n  }\n\n  goNext () {\n    let curr_step = this.current_step || {}\n    this.global_interceptors.beforeNext(curr_step)\n      .then(() => {\n        let _bn = curr_step.call('beforeNext', curr_step)\n        if (!_bn.status) {\n          if (_bn.onError) {\n            _bn.onError.apply(curr_step)\n          }\n          return\n        }\n        let next_step = curr_step.next || null\n        if (next_step) {\n          this.goToStep(this.step(next_step), { from: curr_step.name })\n        } else {\n          if (this.onFinish) {\n            this.onFinish()\n          }\n        }\n      })\n      .catch(() => { })\n    return this\n  }\n\n  goBack () {\n    let curr_step = this.current_step || {}\n    this.global_interceptors.beforeBack(curr_step)\n      .then(() => {\n        let prev_step = curr_step.from || null\n        let _bb = curr_step.call('beforeBack', curr_step) || { status: false }\n        if (!_bb.status) {\n          if (_bb.onError) _bb.onError.apply(curr_step)\n          return\n        }\n        if (prev_step) {\n          if (_bb.status) {\n            this.steps_past.pop()\n          }\n          this.goToStep(this.step(prev_step), { is_back: true })\n        }\n      })\n      .catch(() => {})\n    return this\n  }\n\n  goToStep (step, params = {}) {\n    let is_skip = this.global_interceptors.isSkipGlobal(step) || step.call('isSkip', step)\n    if (is_skip) {\n      step = this.step(step.next)\n    }\n    let from = params.from || null\n    let is_back = params.is_back || false\n    if (from) {\n      step.from = from\n    }\n    this.render(step)\n    this._current_step = step.name\n    if (this.steps_past.indexOf(step.name) < 0) {\n      this.steps_past.push(step.name)\n    }\n    this.updateProgress()\n    return this\n  }\n\n  collectData () {\n    let data = {}\n    for (var step in this.steps) {\n      if (this.step(step).data) {\n        data[step] = this.step(step).data\n      }\n    }\n    return data\n  }\n\n  init (first_step) {\n    this.first_step = first_step\n    this.commonHandlers()\n    this._current_step = this.first_step\n    this.goToStep(this.step(this._current_step))\n  }\n}\n","import { Step } from '../classes/Step'\nimport { StepSystem } from '../classes/StepSystem'\n\nwindow.app = new StepSystem({\n  container: $('.container'),\n  step_class: '.step'\n});\n\n(function (app) {\n\n  const first_step = 'first-step'\n\n  app\n  /**\n   * COMMON HANDLERS\n   */\n  .setHandlers(() => {\n    console.log('handlers init')\n\n  })\n  \n  /**\n   * FIRST STEP\n   */\n  .addStep(new Step({\n    name: 'first-step',\n    next: 'second-step',\n    methods: {\n      beforeRender: (step) => {\n        console.log('first-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: (step) => {\n        console.log('first-step beforeNext', this)\n        step.data.lol = 'lol'\n        return { status: true }\n      },\n      onRender: (step) => {\n        app.container.find('.step').css({'color': 'green'})\n      }\n    }\n  }))\n\n  /**\n   * SECOND STEP\n   */\n  .addStep(new Step({\n    name: 'second-step',\n    next: 'third-step',\n    methods: {\n      isSkip: (step) => {\n        return app.step('first-step').data.lol == 'lol'\n      },\n      beforeRender: (step) => {\n        console.log('second-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: (step) => {\n        console.log('second-step beforeNext')\n        step.data.azaza = 'azaza'\n        return { status: true }\n      },\n      onRender: (step) => {\n        app.container.find('.step').css({'color': 'red'})\n      }\n    }\n  }))\n\n  /**\n   * THIRD STEP\n   */\n  .addStep(new Step({\n    name: 'third-step',\n    methods: {\n      beforeRender: (step) => {\n        console.log('third-step beforeRender')\n        return { status: true }\n      },\n      beforeNext: (step) => {\n        console.log('third-step beforeNext')\n        step.data.kek = 'kek'\n        return { status: true }\n      },\n      onRender: (step) => {\n        app.container.find('.step').css({'color': 'blue'})\n      }\n    }\n  }))\n\n  /**\n   * FINISH\n   */\n  .addStep(new Step({\n    name: 'finish',\n    hide_progress: true,\n    ignore_progress: true,\n    methods: {\n      beforeRender: (step) => {\n        console.log('finish beforeRender')\n        return { status: true }\n      },\n      beforeNext: (step) => {\n        console.log('finish beforeNext')\n        step.data.kek = 'kek'\n        return { status: true }\n      },\n      onRender: (step) => {\n        step.call('anyOfInternalMethods')\n      },\n      anyOfInternalMethods: () => {\n        alert ('Hey there')\n      }\n    }\n  }))\n\n  /**\n   * GLOBAL\n   */\n\n  app.onFinish = () => {\n    app.goToStep(app.step('finish'))\n    console.log(app.collectData())\n  }\n\n  app.onProgress = (progress) => {\n    app.container.find('.progress').html(Math.floor(progress) + '%')\n  }\n\n  app.onStepRender = (step) => {\n    app.container.find('.step .next').click(function () {\n      app.goNext()\n    })\n    app.container.find('.step .back').click(function () {\n      app.goBack()\n    })\n\n    console.log(step)\n\n    if (step.hide_progress) {\n      app.container.find('.progress').hide()\n    } else {\n      app.container.find('.progress').show()\n    }\n  }\n\n  app.init(first_step)\n\n})(window.app)\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjbGFzc2VzL1N0ZXAuanMiLCJjbGFzc2VzL1N0ZXBTeXN0ZW0uanMiLCJleGFtcGxlL2FwcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7SUNBYSxJLFdBQUEsSTtBQUNYLGdCQUFhLE1BQWIsRUFBcUI7QUFBQTs7QUFDbkIsU0FBSyxNQUFMLEdBQWMsT0FBTyxNQUFQLElBQWlCLElBQS9CO0FBQ0EsU0FBSyxJQUFMLEdBQVksT0FBTyxJQUFuQjtBQUNBLFNBQUssSUFBTCxHQUFZLE9BQU8sSUFBbkI7QUFDQSxTQUFLLE9BQUwsR0FBZSxPQUFPLE9BQVAsSUFBa0IsRUFBakM7QUFDQSxTQUFLLFFBQUwsR0FBZ0IsT0FBTyxRQUFQLElBQW1CLEVBQW5DO0FBQ0EsU0FBSyxlQUFMLEdBQXVCLE9BQU8sZUFBUCxJQUEwQixLQUFqRDtBQUNBLFNBQUssYUFBTCxHQUFxQixPQUFPLGFBQVAsSUFBd0IsS0FBN0M7QUFDQSxTQUFLLElBQUwsR0FBWSxJQUFaO0FBQ0EsU0FBSyxRQUFMLEdBQWdCLE9BQU8sUUFBUCxJQUFtQixLQUFuQztBQUNBLFNBQUssS0FBTCxHQUFhLE9BQU8sSUFBUCxJQUFlLEVBQTVCO0FBQ0EsV0FBTyxZQUFQLEdBQXNCLE9BQU8sWUFBUCxJQUF1QixFQUE3QztBQUNBLFNBQUssWUFBTCxHQUFvQjtBQUNsQixjQUFRLE9BQU8sWUFBUCxDQUFvQixNQUFwQixJQUE4QixLQUFLLE9BQUwsQ0FBYSxNQUEzQyxJQUFxRCxZQUFZO0FBQ3ZFLGVBQU8sS0FBUDtBQUNELE9BSGlCO0FBSWxCLG9CQUFjLE9BQU8sWUFBUCxDQUFvQixZQUFwQixJQUFvQyxLQUFLLE9BQUwsQ0FBYSxZQUFqRCxJQUFpRSxZQUFZO0FBQ3pGLGVBQU8sRUFBQyxRQUFRLElBQVQsRUFBUDtBQUNELE9BTmlCO0FBT2xCLGtCQUFZLE9BQU8sWUFBUCxDQUFvQixVQUFwQixJ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Q0FBbUIsV0FBbkIsRUFBZ0MsSUFBaEMsQ0FBcUMsS0FBSyxLQUFMLENBQVcsUUFBWCxJQUF1QixHQUE1RDtBQUNELEdBRkQ7O0FBSUEsTUFBSSxZQUFKLEdBQW1CLFVBQUMsSUFBRCxFQUFVO0FBQzNCLFFBQUksU0FBSixDQUFjLElBQWQsQ0FBbUIsYUFBbkIsRUFBa0MsS0FBbEMsQ0FBd0MsWUFBWTtBQUNsRCxVQUFJLE1BQUo7QUFDRCxLQUZEO0FBR0EsUUFBSSxTQUFKLENBQWMsSUFBZCxDQUFtQixhQUFuQixFQUFrQyxLQUFsQyxDQUF3QyxZQUFZO0FBQ2xELFVBQUksTUFBSjtBQUNELEtBRkQ7O0FBSUEsWUFBUSxHQUFSLENBQVksSUFBWjs7QUFFQSxRQUFJLEtBQUssYUFBVCxFQUF3QjtBQUN0QixVQUFJLFNBQUosQ0FBYyxJQUFkLENBQW1CLFdBQW5CLEVBQWdDLElBQWhDO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsVUFBSSxTQUFKLENBQWMsSUFBZCxDQUFtQixXQUFuQixFQUFnQyxJQUFoQztBQUNEO0FBQ0YsR0FmRDs7QUFpQkEsTUFBSSxJQUFKLENBQVMsVUFBVDtBQUVELENBM0lELEVBMklHLE9BQU8sR0EzSVYiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiZXhwb3J0IGNsYXNzIFN0ZXAge1xuICBjb25zdHJ1Y3RvciAocGFyYW1zKSB7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJhbXMucGFyZW50IHx8IG51bGxcbiAgICB0aGlzLm5hbWUgPSBwYXJhbXMubmFtZVxuICAgIHRoaXMubmV4dCA9IHBhcmFtcy5uZXh0XG4gICAgdGhpcy5tZXRob2RzID0gcGFyYW1zLm1ldGhvZHMgfHwge31cbiAgICB0aGlzLnRlbXBsYXRlID0gcGFyYW1zLnRlbXBsYXRlIHx8ICcnXG4gICAgdGhpcy5pZ25vcmVfcHJvZ3Jlc3MgPSBwYXJhbXMuaWdub3JlX3Byb2dyZXNzIHx8IGZhbHNlXG4gICAgdGhpcy5oaWRlX3Byb2dyZXNzID0gcGFyYW1zLmhpZGVfcHJvZ3Jlc3MgfHwgZmFsc2VcbiAgICB0aGlzLmZyb20gPSBudWxsXG4gICAgdGhpcy5yZXF1aXJlZCA9IHBhcmFtcy5yZXF1aXJlZCB8fCBmYWxzZVxuICAgIHRoaXMuX2RhdGEgPSBwYXJhbXMuZGF0YSB8fCB7fVxuICAgIHBhcmFtcy5pbnRlcmNlcHRvcnMgPSBwYXJhbXMuaW50ZXJjZXB0b3JzIHx8IHt9XG4gICAgdGhpcy5pbnRlcmNlcHRvcnMgPSB7XG4gICAgICBpc1NraXA6IHBhcmFtcy5pbnRlcmNlcHRvcnMuaXNTa2lwIHx8IHRoaXMubWV0aG9kcy5pc1NraXAgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH0sXG4gICAgICBiZWZvcmVSZW5kZXI6IHBhcmFtcy5pbnRlcmNlcHRvcnMuYmVmb3JlUmVuZGVyIHx8IHRoaXMubWV0aG9kcy5iZWZvcmVSZW5kZXIgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge3N0YXR1czogdHJ1ZX1cbiAgICAgIH0sXG4gICAgICBiZWZvcmVOZXh0OiBwYXJhbXMuaW50ZXJjZXB0b3JzLmJlZm9yZU5leHQgfHwgdGhpcy5tZXRob2RzLmJlZm9yZU5leHQgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge3N0YXR1czogdHJ1ZX1cbiAgICAgIH0sXG4gICAgICBiZWZvcmVCYWNrOiBwYXJhbXMuaW50ZXJjZXB0b3JzLmJlZm9yZUJhY2sgfHwgdGhpcy5tZXRob2RzLmJlZm9yZUJhY2sgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge3N0YXR1czogdHJ1ZX1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiBMSU5LUyAqL1xuICBnZXQgZ29OZXh0ICgpIHsgcmV0dXJuIHRoaXMucGFyZW50LmdvTmV4dCB9XG4gIGdldCBnb0JhY2sgKCkgeyByZXR1cm4gdGhpcy5wYXJlbnQuZ29CYWNrIH1cbiAgZ2V0IGdvVG9TdGVwICgpIHsgcmV0dXJuIHRoaXMucGFyZW50LmdvVG9TdGVwIH1cblxuICBnZXQgZGF0YSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGFcbiAgfVxuXG4gIGdldCBjb250YWluZXIgKCkge1xuICAgIHJldHVybiB0aGlzLnBhcmVudC5jb250YWluZXIuZmluZCh0aGlzLnBhcmVudC5fc3RlcF9jb250YWluZXIpXG4gIH1cblxuICBjYWxsIChtZXRob2QsIC4uLmFyZ3MpIHtcbiAgICBsZXQgZm5jID0gdGhpcy5tZXRob2RzW21ldGhvZF0gfHwgdGhpcy5pbnRlcmNlcHRvcnNbbWV0aG9kXVxuICAgIGlmIChmbmMpIHtcbiAgICAgIHJldHVybiBmbmMuYXBwbHkodGhpcywgYXJncylcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogU3RlcFN5c3RlbSB2MS4wLjFcbiAqIExhc3QgdXBkYXRlOiAyNS4wNS4yMDE3XG4gKlxuICogRGVwZW5kZW5jaWVzOiBqUXVlcnlcbiAqXG4gKiBAYXV0aG9yIGthc2thcjIwMDhcbiAqL1xuXG5leHBvcnQgY2xhc3MgU3RlcFN5c3RlbSB7XG4gIC8qKlxuICAgKiBAcGFyYW0gIHtqUXVlcnkgZWxlbWVudH0gY29udGFpbmVyXG4gICAqL1xuICBjb25zdHJ1Y3RvciAocGFyYW1zKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB7fVxuICAgIHRoaXMuX2N1cnJlbnRfc3RlcCA9IG51bGxcbiAgICB0aGlzLl9jb250YWluZXIgPSBwYXJhbXMuY29udGFpbmVyIHx8ICQoJy5zdGVwLXN5c3RlbScpXG4gICAgdGhpcy5fc3RlcF9jb250YWluZXIgPSBwYXJhbXMuc3RlcF9jbGFzcyB8fCAnLnN0ZXAnXG4gICAgdGhpcy5fbmV4dF90aW1lb3V0ID0gbnVsbFxuICAgIHRoaXMuc3RlcHNfcGFzdCA9IFtdXG4gICAgdGhpcy5wcm9ncmVzcyA9IDBcbiAgICB0aGlzLmNvbW1vbkhhbmRsZXJzID0gZnVuY3Rpb24gKCkge31cbiAgICB0aGlzLm9uRmluaXNoID0gZnVuY3Rpb24gKCkge31cbiAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoKSB7fVxuICAgIHRoaXMub25TdGVwUmVuZGVyID0gZnVuY3Rpb24gKCkge31cblxuICAgIHRoaXMuX2dsb2JhbF9pbnRlcmNlcHRvcnMgPSB7XG4gICAgICBpc1NraXBHbG9iYWw6IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICAgIHJldHVybiBzdGVwLmludGVyY2VwdG9ycy5pc1NraXAoc3RlcClcbiAgICAgIH0sXG4gICAgICBiZWZvcmVOZXh0OiBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBiZWZvcmVCYWNrOiBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIG5ldyBzdGVwXG4gICAqIEBwYXJhbSB7U3RlcH0gc3RlcFxuICAgKi9cbiAgYWRkU3RlcCAoc3RlcCkge1xuICAgIHN0ZXAucGFyZW50ID0gdGhpc1xuICAgIHRoaXMuX3N0ZXBzW3N0ZXAubmFtZV0gPSBzdGVwXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHNldEdsb2JhbEludGVyY2VwdG9ycyAoaW50ZXJjZXB0b3JzKSB7XG4gICAgdGhpcy5fZ2xvYmFsX2ludGVyY2VwdG9ycyA9IE9iamVjdC5hc3NpZ24odGhpcy5fZ2xvYmFsX2ludGVyY2VwdG9ycywgaW50ZXJjZXB0b3JzKVxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBzZXRIYW5kbGVycyAoY2IpIHtcbiAgICB0aGlzLmNvbW1vbkhhbmRsZXJzID0gY2JcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgZ2V0IGdsb2JhbF9pbnRlcmNlcHRvcnMgKCkge1xuICAgIHJldHVybiB0aGlzLl9nbG9iYWxfaW50ZXJjZXB0b3JzXG4gIH1cblxuICBnZXQgY3VycmVudF9zdGVwICgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGVwKHRoaXMuX2N1cnJlbnRfc3RlcCkgfHwgbnVsbFxuICB9XG5cbiAgc3RlcCAobmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9zdGVwc1tuYW1lXVxuICB9XG5cbiAgZ2V0IGNvbnRhaW5lciAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lclxuICB9XG5cbiAgZ2V0IHN0ZXBzICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RlcHNcbiAgfVxuXG4gIGdldCBhbGxfZGF0YSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sbGVjdERhdGEoKVxuICB9XG5cbiAgcmVuZGVyIChzdGVwKSB7XG4gICAgbGV0IF9iciA9IHN0ZXAuY2FsbCgnYmVmb3JlUmVuZGVyJywgc3RlcClcbiAgICBpZiAoIV9ici5zdGF0dXMpIHtcbiAgICAgIGlmIChfYnIub25FcnJvcikgX2JyLm9uRXJyb3IuYXBwbHkoc3RlcClcbiAgICAgIHJldHVybiB0aGlzXG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyLmZpbmQodGhpcy5fc3RlcF9jb250YWluZXIpLmh0bWwoc3RlcC50ZW1wbGF0ZSB8fCB0aGlzLl9jb250YWluZXIuZmluZChgIyR7c3RlcC5uYW1lfWApLmh0bWwoKSlcbiAgICB0aGlzLmNvbnRhaW5lci5maW5kKHRoaXMuX3N0ZXBfY29udGFpbmVyKS5hdHRyKCdkYXRhLW5hbWUnLCBzdGVwLm5hbWUpXG4gICAgdGhpcy5vblN0ZXBSZW5kZXIoc3RlcClcbiAgICBzdGVwLmNhbGwoJ29uUmVuZGVyJywgc3RlcClcbiAgfVxuXG4gIHVwZGF0ZVByb2dyZXNzICgpIHtcbiAgICBsZXQgZnV0dXJlX3N0ZXBzID0gMFxuICAgIGxldCBpdGVyYXRpb25fc3RlcCA9IHRoaXMuY3VycmVudF9zdGVwXG4gICAgbGV0IGl0ZXJhdGlvbl9uZXh0X3N0ZXAgPSBpdGVyYXRpb25fc3RlcC5uZXh0XG4gICAgd2hpbGUgKGl0ZXJhdGlvbl9uZXh0X3N0ZXApIHtcbiAgICAgIGlmICghaXRlcmF0aW9uX3N0ZXAuaWdub3JlX3Byb2dyZXNzKSB7XG4gICAgICAgIGZ1dHVyZV9zdGVwcysrXG4gICAgICB9XG4gICAgICBpdGVyYXRpb25fc3RlcCA9IHRoaXMuc3RlcChpdGVyYXRpb25fbmV4dF9zdGVwKVxuICAgICAgaXRlcmF0aW9uX25leHRfc3RlcCA9IGl0ZXJhdGlvbl9zdGVwLm5leHRcbiAgICB9XG4gICAgdGhpcy5wcm9ncmVzcyA9ICh0aGlzLnN0ZXBzX3Bhc3QubGVuZ3RoICogMTAwKSAvICh0aGlzLnN0ZXBzX3Bhc3QubGVuZ3RoICsgZnV0dXJlX3N0ZXBzKVxuICAgIHRoaXMub25Qcm9ncmVzcyh0aGlzLnByb2dyZXNzKVxuICB9XG5cbiAgZ29OZXh0VGltZW91dCAodGltZW91dCA9IDMwMCkge1xuICAgIGNvbnN0ICR0aGlzID0gdGhpc1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl9uZXh0X3RpbWVvdXQpXG4gICAgdGhpcy5fbmV4dF90aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAkdGhpcy5nb05leHQoKVxuICAgIH0sIHRpbWVvdXQpXG4gIH1cblxuICBnb05leHQgKCkge1xuICAgIGxldCBjdXJyX3N0ZXAgPSB0aGlzLmN1cnJlbnRfc3RlcCB8fCB7fVxuICAgIHRoaXMuZ2xvYmFsX2ludGVyY2VwdG9ycy5iZWZvcmVOZXh0KGN1cnJfc3RlcClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgbGV0IF9ibiA9IGN1cnJfc3RlcC5jYWxsKCdiZWZvcmVOZXh0JywgY3Vycl9zdGVwKVxuICAgICAgICBpZiAoIV9ibi5zdGF0dXMpIHtcbiAgICAgICAgICBpZiAoX2JuLm9uRXJyb3IpIHtcbiAgICAgICAgICAgIF9ibi5vbkVycm9yLmFwcGx5KGN1cnJfc3RlcClcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5leHRfc3RlcCA9IGN1cnJfc3RlcC5uZXh0IHx8IG51bGxcbiAgICAgICAgaWYgKG5leHRfc3RlcCkge1xuICAgICAgICAgIHRoaXMuZ29Ub1N0ZXAodGhpcy5zdGVwKG5leHRfc3RlcCksIHsgZnJvbTogY3Vycl9zdGVwLm5hbWUgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5vbkZpbmlzaCkge1xuICAgICAgICAgICAgdGhpcy5vbkZpbmlzaCgpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKCgpID0+IHsgfSlcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgZ29CYWNrICgpIHtcbiAgICBsZXQgY3Vycl9zdGVwID0gdGhpcy5jdXJyZW50X3N0ZXAgfHwge31cbiAgICB0aGlzLmdsb2JhbF9pbnRlcmNlcHRvcnMuYmVmb3JlQmFjayhjdXJyX3N0ZXApXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGxldCBwcmV2X3N0ZXAgPSBjdXJyX3N0ZXAuZnJvbSB8fCBudWxsXG4gICAgICAgIGxldCBfYmIgPSBjdXJyX3N0ZXAuY2FsbCgnYmVmb3JlQmFjaycsIGN1cnJfc3RlcCkgfHwgeyBzdGF0dXM6IGZhbHNlIH1cbiAgICAgICAgaWYgKCFfYmIuc3RhdHVzKSB7XG4gICAgICAgICAgaWYgKF9iYi5vbkVycm9yKSBfYmIub25FcnJvci5hcHBseShjdXJyX3N0ZXApXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXZfc3RlcCkge1xuICAgICAgICAgIGlmIChfYmIuc3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLnN0ZXBzX3Bhc3QucG9wKClcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5nb1RvU3RlcCh0aGlzLnN0ZXAocHJldl9zdGVwKSwgeyBpc19iYWNrOiB0cnVlIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKCkgPT4ge30pXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIGdvVG9TdGVwIChzdGVwLCBwYXJhbXMgPSB7fSkge1xuICAgIGxldCBpc19za2lwID0gdGhpcy5nbG9iYWxfaW50ZXJjZXB0b3JzLmlzU2tpcEdsb2JhbChzdGVwKSB8fCBzdGVwLmNhbGwoJ2lzU2tpcCcsIHN0ZXApXG4gICAgaWYgKGlzX3NraXApIHtcbiAgICAgIHN0ZXAgPSB0aGlzLnN0ZXAoc3RlcC5uZXh0KVxuICAgIH1cbiAgICBsZXQgZnJvbSA9IHBhcmFtcy5mcm9tIHx8IG51bGxcbiAgICBsZXQgaXNfYmFjayA9IHBhcmFtcy5pc19iYWNrIHx8IGZhbHNlXG4gICAgaWYgKGZyb20pIHtcbiAgICAgIHN0ZXAuZnJvbSA9IGZyb21cbiAgICB9XG4gICAgdGhpcy5yZW5kZXIoc3RlcClcbiAgICB0aGlzLl9jdXJyZW50X3N0ZXAgPSBzdGVwLm5hbWVcbiAgICBpZiAodGhpcy5zdGVwc19wYXN0LmluZGV4T2Yoc3RlcC5uYW1lKSA8IDApIHtcbiAgICAgIHRoaXMuc3RlcHNfcGFzdC5wdXNoKHN0ZXAubmFtZSlcbiAgICB9XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzcygpXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIGNvbGxlY3REYXRhICgpIHtcbiAgICBsZXQgZGF0YSA9IHt9XG4gICAgZm9yICh2YXIgc3RlcCBpbiB0aGlzLnN0ZXBzKSB7XG4gICAgICBpZiAodGhpcy5zdGVwKHN0ZXApLmRhdGEpIHtcbiAgICAgICAgZGF0YVtzdGVwXSA9IHRoaXMuc3RlcChzdGVwKS5kYXRhXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhXG4gIH1cblxuICBpbml0IChmaXJzdF9zdGVwKSB7XG4gICAgdGhpcy5maXJzdF9zdGVwID0gZmlyc3Rfc3RlcFxuICAgIHRoaXMuY29tbW9uSGFuZGxlcnMoKVxuICAgIHRoaXMuX2N1cnJlbnRfc3RlcCA9IHRoaXMuZmlyc3Rfc3RlcFxuICAgIHRoaXMuZ29Ub1N0ZXAodGhpcy5zdGVwKHRoaXMuX2N1cnJlbnRfc3RlcCkpXG4gIH1cbn1cbiIsImltcG9ydCB7IFN0ZXAgfSBmcm9tICcuLi9jbGFzc2VzL1N0ZXAnXG5pbXBvcnQgeyBTdGVwU3lzdGVtIH0gZnJvbSAnLi4vY2xhc3Nlcy9TdGVwU3lzdGVtJ1xuXG53aW5kb3cuYXBwID0gbmV3IFN0ZXBTeXN0ZW0oe1xuICBjb250YWluZXI6ICQoJy5jb250YWluZXInKSxcbiAgc3RlcF9jbGFzczogJy5zdGVwJ1xufSk7XG5cbihmdW5jdGlvbiAoYXBwKSB7XG5cbiAgY29uc3QgZmlyc3Rfc3RlcCA9ICdmaXJzdC1zdGVwJ1xuXG4gIGFwcFxuICAvKipcbiAgICogQ09NTU9OIEhBTkRMRVJTXG4gICAqL1xuICAuc2V0SGFuZGxlcnMoKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdoYW5kbGVycyBpbml0JylcblxuICB9KVxuICBcbiAgLyoqXG4gICAqIEZJUlNUIFNURVBcbiAgICovXG4gIC5hZGRTdGVwKG5ldyBTdGVwKHtcbiAgICBuYW1lOiAnZmlyc3Qtc3RlcCcsXG4gICAgbmV4dDogJ3NlY29uZC1zdGVwJyxcbiAgICBtZXRob2RzOiB7XG4gICAgICBiZWZvcmVSZW5kZXI6IChzdGVwKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmaXJzdC1zdGVwIGJlZm9yZVJlbmRlcicpXG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSB9XG4gICAgICB9LFxuICAgICAgYmVmb3JlTmV4dDogKHN0ZXApID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ZpcnN0LXN0ZXAgYmVmb3JlTmV4dCcsIHRoaXMpXG4gICAgICAgIHN0ZXAuZGF0YS5sb2wgPSAnbG9sJ1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIG9uUmVuZGVyOiAoc3RlcCkgPT4ge1xuICAgICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwJykuY3NzKHsnY29sb3InOiAnZ3JlZW4nfSlcbiAgICAgIH1cbiAgICB9XG4gIH0pKVxuXG4gIC8qKlxuICAgKiBTRUNPTkQgU1RFUFxuICAgKi9cbiAgLmFkZFN0ZXAobmV3IFN0ZXAoe1xuICAgIG5hbWU6ICdzZWNvbmQtc3RlcCcsXG4gICAgbmV4dDogJ3RoaXJkLXN0ZXAnLFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIGlzU2tpcDogKHN0ZXApID0+IHtcbiAgICAgICAgcmV0dXJuIGFwcC5zdGVwKCdmaXJzdC1zdGVwJykuZGF0YS5sb2wgPT0gJ2xvbCdcbiAgICAgIH0sXG4gICAgICBiZWZvcmVSZW5kZXI6IChzdGVwKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWNvbmQtc3RlcCBiZWZvcmVSZW5kZXInKVxuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIGJlZm9yZU5leHQ6IChzdGVwKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWNvbmQtc3RlcCBiZWZvcmVOZXh0JylcbiAgICAgICAgc3RlcC5kYXRhLmF6YXphID0gJ2F6YXphJ1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIG9uUmVuZGVyOiAoc3RlcCkgPT4ge1xuICAgICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwJykuY3NzKHsnY29sb3InOiAncmVkJ30pXG4gICAgICB9XG4gICAgfVxuICB9KSlcblxuICAvKipcbiAgICogVEhJUkQgU1RFUFxuICAgKi9cbiAgLmFkZFN0ZXAobmV3IFN0ZXAoe1xuICAgIG5hbWU6ICd0aGlyZC1zdGVwJyxcbiAgICBtZXRob2RzOiB7XG4gICAgICBiZWZvcmVSZW5kZXI6IChzdGVwKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aGlyZC1zdGVwIGJlZm9yZVJlbmRlcicpXG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSB9XG4gICAgICB9LFxuICAgICAgYmVmb3JlTmV4dDogKHN0ZXApID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXJkLXN0ZXAgYmVmb3JlTmV4dCcpXG4gICAgICAgIHN0ZXAuZGF0YS5rZWsgPSAna2VrJ1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIG9uUmVuZGVyOiAoc3RlcCkgPT4ge1xuICAgICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwJykuY3NzKHsnY29sb3InOiAnYmx1ZSd9KVxuICAgICAgfVxuICAgIH1cbiAgfSkpXG5cbiAgLyoqXG4gICAqIEZJTklTSFxuICAgKi9cbiAgLmFkZFN0ZXAobmV3IFN0ZXAoe1xuICAgIG5hbWU6ICdmaW5pc2gnLFxuICAgIGhpZGVfcHJvZ3Jlc3M6IHRydWUsXG4gICAgaWdub3JlX3Byb2dyZXNzOiB0cnVlLFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIGJlZm9yZVJlbmRlcjogKHN0ZXApID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ZpbmlzaCBiZWZvcmVSZW5kZXInKVxuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIGJlZm9yZU5leHQ6IChzdGVwKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmaW5pc2ggYmVmb3JlTmV4dCcpXG4gICAgICAgIHN0ZXAuZGF0YS5rZWsgPSAna2VrJ1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUgfVxuICAgICAgfSxcbiAgICAgIG9uUmVuZGVyOiAoc3RlcCkgPT4ge1xuICAgICAgICBzdGVwLmNhbGwoJ2FueU9mSW50ZXJuYWxNZXRob2RzJylcbiAgICAgIH0sXG4gICAgICBhbnlPZkludGVybmFsTWV0aG9kczogKCkgPT4ge1xuICAgICAgICBhbGVydCAoJ0hleSB0aGVyZScpXG4gICAgICB9XG4gICAgfVxuICB9KSlcblxuICAvKipcbiAgICogR0xPQkFMXG4gICAqL1xuXG4gIGFwcC5vbkZpbmlzaCA9ICgpID0+IHtcbiAgICBhcHAuZ29Ub1N0ZXAoYXBwLnN0ZXAoJ2ZpbmlzaCcpKVxuICAgIGNvbnNvbGUubG9nKGFwcC5jb2xsZWN0RGF0YSgpKVxuICB9XG5cbiAgYXBwLm9uUHJvZ3Jlc3MgPSAocHJvZ3Jlc3MpID0+IHtcbiAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5wcm9ncmVzcycpLmh0bWwoTWF0aC5mbG9vcihwcm9ncmVzcykgKyAnJScpXG4gIH1cblxuICBhcHAub25TdGVwUmVuZGVyID0gKHN0ZXApID0+IHtcbiAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwIC5uZXh0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgYXBwLmdvTmV4dCgpXG4gICAgfSlcbiAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5zdGVwIC5iYWNrJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgYXBwLmdvQmFjaygpXG4gICAgfSlcblxuICAgIGNvbnNvbGUubG9nKHN0ZXApXG5cbiAgICBpZiAoc3RlcC5oaWRlX3Byb2dyZXNzKSB7XG4gICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5wcm9ncmVzcycpLmhpZGUoKVxuICAgIH0gZWxzZSB7XG4gICAgICBhcHAuY29udGFpbmVyLmZpbmQoJy5wcm9ncmVzcycpLnNob3coKVxuICAgIH1cbiAgfVxuXG4gIGFwcC5pbml0KGZpcnN0X3N0ZXApXG5cbn0pKHdpbmRvdy5hcHApXG4iXX0="}